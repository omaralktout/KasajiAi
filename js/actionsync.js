/* ===== Translations ===== */
const translations = {
  en: {
    "nav-voicepulse": "VoicePulse",
    "nav-insightai": "InsightAI",
    "nav-actionsync": "ActionSync",
    "nav-insights": "Our Insights",
    "nav-about": "About Us",
    "nav-signup": "Sign up",

    "hero-title-actionsync": "ActionSync",
    "hero-description-actionsync":
      "A real-time execution layer powered by AI to turn insights into immediate actions across the care journey.",

    "i18n":
      "Five Execution Nodes: Powering Real-Time Patient Experience Transformation",
    "i18n":
      "Unlock the full potential of patient experience with our intelligent action layer—driven by AI and designed to deliver immediate, meaningful impact across every touchpoint in the care journey",

    "node-1-title": "Proactive Patient Outreach & Complaint Resolution",
    "node-1-desc":
      "Preemptive intervention reduces escalation and transforms potential complaints into opportunities for increased trust and satisfaction. Anticipate patient concerns before they escalate. Our system identifies early signals of dissatisfaction and initiates timely outreach, turning potential complaints into moments of empathy, trust-building, and loyalty.",
    "node-1-tag-1": "Alert Automation",
    "node-1-tag-2": "Patient Interaction",

    "node-2-title": "Experience-Driven Care Recommendations",
    "node-2-desc":
      "Transform experience insights into actionable clinical and operational decisions. Whether it’s adjusting care plans or refining service delivery, our platform ensures that every recommendation enhances quality and responsiveness in real time.",
    "node-2-tag-1": "Clinical Intelligence",
    "node-2-tag-2": "Care Optimization",

    "node-3-title": "Virtual Health Assistants",
    "node-3-desc":
      "Provide instant, multilingual support across digital and physical channels. These AI-powered assistants reduce staff burden, accelerate patient response times, and ensure seamless communication—anytime, anywhere.",
    "node-3-tag-1": "Conversational AI",
    "node-3-tag-2": "Chatbots",

    "node-4-title": "AI-Powered Care Coordination Agents",
    "node-4-desc":
      "Automate coordination across clinical, administrative, and support teams. These agents eliminate bottlenecks, reduce delays, and prevent decision conflicts, ensuring that care delivery is synchronized and efficient.",
    "node-4-tag-1": "Team Coordination",
    "node-4-tag-2": "Workflow Automation",

    "node-5-title": "Agentic AI–Enabled Care Navigator",
    "node-5-desc":
      "Guide patients through their care journey with intelligent, real-time navigation. From appointment scheduling to follow-up reminders, this agent reduces confusion, improves adherence, and enhances continuity of care.",
    "node-5-tag-1": "Journey Mapping",
    "node-5-tag-2": "Autonomous Agents",

    "contact-title": "Ready to Transform Your Business?",
    "contact-subtitle":
      "Get started today and see the difference our platform can make",
    "contact-info-title": "Contact Information",
    "contact-phone": "Phone",
    "contact-email": "Email",
    "contact-address": "Address",

    "form-name": "Your Name",
    "form-email": "Your Email",
    "form-message": "Your Message",
    "form-submit": "Send Message",

    "footer-description":
      "Transforming businesses through intelligent customer insights",
    "footer-copyright":
      "© 2025 Kasaji.AI. All rights reserved."
  },
  ar: {
    "logo-text": "VoicePulse",
    "nav-voicepulse": "VoicePulse",
    "nav-insightai": "InsightAI",
    "nav-actionsync": "ActionSync",
    "nav-insights": "Our Insights",
    "nav-about": "About Us",
    "nav-signup": "تسجيل دخول",

    "hero-title-actionsync": "ActionSync",
    "hero-description-actionsync":
      "طبقة تنفيذ فورية مدعومة بالذكاء الاصطناعي، تحوّل الرؤى إلى أفعال مباشرة عبر رحلة الرعاية.",

    "content-title": "خمسة محاور تنفيذ ذكية",
    "content-subtitle":
      "حيث تقود توصيات الذكاء الاصطناعي قراراتك القادمة",

    "node-1-title": "التواصل الاستباقي مع المرضى وحل الشكاوى مبكرًا",
    "node-1-desc":
      "التدخل المبكر يمنع تصاعد المشكلة ويحوّل الشكاوى المحتملة إلى فرص لبناء ثقة ورفع مستوى الرضا.",
    "node-1-tag-1": "إشعارات ذكية",
    "node-1-tag-2": "تواصل مباشر مع المريض",

    "node-2-title": "توصيات رعاية مبنية على التجربة",
    "node-2-desc":
      "يتم تحويل رؤى التجربة فورًا إلى قرارات تشغيلية أو سريرية تعزز جودة الرعاية في اللحظة نفسها.",
    "node-2-tag-1": "تحليل سريري ذكي",
    "node-2-tag-2": "رفع كفاءة مسار العلاج",

    "node-3-title": "المساعد الافتراضي للرعاية الصحية",
    "node-3-desc":
      "دعم فوري ومتعدد اللغات يخفف العبء عن الكادر الطبي ويُسرّع الاستجابة للمريض عبر مختلف نقاط التواصل.",
    "node-3-tag-1": "مكالمات آلية بذكاء اصطناعي",
    "node-3-tag-2": "دردشة ذكية",

    "node-4-title": "منسّق رعاية ذكي بالذكاء الاصطناعي",
    "node-4-desc":
      "مساعد ذكي ينظّم كل من يشارك في رحلة المريض… دون الحاجة للتذكير أو المتابعة اليدوية.",
    "node-4-tag-1": "تنسيق الفرق",
    "node-4-tag-2": "إدارة العمل بشكل آلي",

    "node-5-title": "موجّه رحلة المريض بالذكاء الاصطناعي",
    "node-5-desc":
      "توجيه فوري ومباشر يرافق المريض في رحلته العلاجية لحظة بلحظة، مما يقلل من الارتباك ويمنع فقدان المتابعة.",
    "node-5-tag-1": "أنظمة تعمل تلقائيًا",
    "node-5-tag-2": "رسم مسار رحلة المريض",

    "contact-title": "هل أنت مستعد لتحويل عملك؟",
    "contact-subtitle":
      "ابدأ اليوم واكتشف الأثر الحقيقي الذي يمكن لمنصتنا أن تصنعه.",
    "contact-info-title": "معلومات التواصل",
    "contact-phone": "الهاتف",
    "contact-email": "البريد الإلكتروني",
    "contact-address": "العنوان",

    "form-name": "اسمك",
    "form-email": "بريدك الإلكتروني",
    "form-message": "رسالتك",
    "form-submit": "أرسل الرسالة",

    "footer-description":
      "تحويل الأعمال من خلال رؤى عملاء ذكية",
    "footer-copyright":
      "© 2025 Kasaji.AI. جميع الحقوق محفوظة."
  }
};

// اجعلها متاحة عالميًا إذا بتحب تستخدم window.translations
window.translations = translations;

/* ===== Language State (DEFAULT EN) ===== */
let currentLanguage = localStorage.getItem("language") || "en";

/* ===== Init ===== */
document.addEventListener("DOMContentLoaded", function () {
  updateLanguage();

  // Loader
  const loader = document.getElementById("loader");
  window.addEventListener("load", () => {
    if (!loader) return;
    loader.style.opacity = "0";
    setTimeout(() => (loader.style.display = "none"), 500);
  });

  // Footer animation
  const footerEl = document.querySelector("footer");
  if (footerEl && "IntersectionObserver" in window) {
    const ioFooter = new IntersectionObserver(
      (entries) => entries.forEach((e) => e.isIntersecting && footerEl.classList.add("animate")),
      { threshold: 0.1 }
    );
    ioFooter.observe(footerEl);
  }

  // Mobile menu
  const toggle = document.querySelector(".menu-toggle");
  if (toggle) {
    toggle.addEventListener("click", () => {
      const navLinks = document.querySelector(".nav-links");
      if (!navLinks) return;
      const open = getComputedStyle(navLinks).display !== "none";
      if (open) {
        navLinks.style.display = "none";
      } else {
        navLinks.style.display = "flex";
        navLinks.style.position = "absolute";
        navLinks.style.top = "70px";
        navLinks.style.left = "0";
        navLinks.style.right = "0";
        navLinks.style.flexDirection = "column";
        navLinks.style.backgroundColor = "white";
        navLinks.style.padding = "20px";
        navLinks.style.boxShadow = "0 5px 15px rgba(0,0,0,.1)";
        navLinks.style.zIndex = "1001";
      }
    });
  }

  // Smooth anchors
  document.querySelectorAll('a[href^="#"]').forEach((a) => {
    a.addEventListener("click", (e) => {
      const t = document.querySelector(a.getAttribute("href"));
      if (!t) return;
      e.preventDefault();
      const nav = document.querySelector(".navbar");
      const navH = nav ? nav.offsetHeight : 0;
      window.scrollTo({ top: t.offsetTop - navH, behavior: "smooth" });
    });
  });

  // Timeline reveal (استخدمنا الكلاسات الجديدة tl-row)
  const items = document.querySelectorAll(".tl-row");
  if ("IntersectionObserver" in window) {
    const io = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.classList.add("inview");
            io.unobserve(entry.target);
          }
        });
      },
      { threshold: 0.15, rootMargin: "0px 0px -50px 0px" }
    );
    items.forEach((it) => io.observe(it));
  } else {
    items.forEach((it) => it.classList.add("inview"));
  }
});

/* ===== Toggle Language ===== */
function toggleLanguage() {
  currentLanguage = currentLanguage === "en" ? "ar" : "en";
  localStorage.setItem("language", currentLanguage);
  updateLanguage();
}
window.toggleLanguage = toggleLanguage;

/* ===== Safe Language Update (ما بنمسح أولاد العنصر) ===== */
function updateLanguage() {
  const body = document.body;
  if (currentLanguage === "ar") {
    body.setAttribute("dir", "rtl");
    body.setAttribute("lang", "ar");
  } else {
    body.setAttribute("dir", "ltr");
    body.setAttribute("lang", "en");
  }

  document.querySelectorAll("[data-translate]").forEach((el) => {
    const key = el.getAttribute("data-translate");
    const val = translations[currentLanguage] && translations[currentLanguage][key];
    if (val == null) return;

    // لو محدد target داخلي (مثلاً span.i18n) نحط النص داخله
    const targetSel = el.getAttribute("data-translate-target");
    if (targetSel) {
      const target = el.querySelector(targetSel);
      if (target) target.textContent = val;
      return;
    }

    // لو العنصر Leaf (ما فيه أولاد) نقدر نستبدل نصه مباشرة
    if (el.children.length === 0) {
      el.textContent = val;
    }
    // غير هيك: لا تغيّر شيء (عشان ما نمسح الـ <br> أو العناصر الداخلية)
  });

  // Placeholders
  document.querySelectorAll("[data-translate-placeholder]").forEach((el) => {
    const key = el.getAttribute("data-translate-placeholder");
    const val = translations[currentLanguage] && translations[currentLanguage][key];
    if (val != null) el.placeholder = val;
  });

  // ترجمة خصائص (alt/title/aria-label) اختيارية
  document.querySelectorAll("[data-translate-attr]").forEach((el) => {
    const attr = el.getAttribute("data-translate-attr"); // alt, title, aria-label ...
    const key = el.getAttribute("data-translate-key") || el.getAttribute("data-translate");
    const val = translations[currentLanguage] && translations[currentLanguage][key];
    if (attr && val != null) el.setAttribute(attr, val);
  });
}
// ========== Highlight current nav link ==========
function setActiveNavLink() {
  // احصل على اسم الملف الحالي (actionsync.html / insightai.html ... أو index.html)
  const currentFile = (function () {
    let p = location.pathname.replace(/\/+$/, ""); // شطب / في آخر المسار
    let f = p.split("/").pop();
    return (f && f.length) ? f.toLowerCase() : "index.html";
  })();

  // نورملايز للروابط داخل الناف (يتعامل مع ../ وبدون ملف)
  const normalize = (href) => {
    try {
      const u = new URL(href, location.origin);
      let p = u.pathname.replace(/\/+$/, "");
      let f = p.split("/").pop();
      return (f && f.length) ? f.toLowerCase() : "index.html";
    } catch {
      const f = href.split("/").pop();
      return (f && f.length) ? f.toLowerCase() : "index.html";
    }
  };

  document.querySelectorAll(".nav-links a").forEach((a) => {
    const file = normalize(a.getAttribute("href"));
    // فعّل لو نفس الملف، أو لو إحنا على الرئيسية وروابط الناف راجعة لـ index.html
    if (
      file === currentFile ||
      (currentFile === "index.html" && (file === "" || file === "index.html"))
    ) {
      a.classList.add("is-active");
    } else {
      a.classList.remove("is-active");
    }
  });
}

document.addEventListener("DOMContentLoaded", () => {
  setActiveNavLink();
});
// Smooth scrolling
  document.querySelectorAll('a[href^="#"]').forEach(anchor=>{
    anchor.addEventListener('click', (e)=>{
      const target = document.querySelector(anchor.getAttribute('href'));
      if (!target) return;
      e.preventDefault();
      const navbar = document.querySelector('.navbar');
      const h = navbar ? navbar.offsetHeight : 0;
      window.scrollTo({ top: target.offsetTop - h, behavior: 'smooth' });
    });
  });

  // Navbar shadow
  const navbar = document.querySelector('.navbar');
  window.addEventListener('scroll', ()=>{
    if (!navbar) return;
    navbar.style.boxShadow = window.scrollY > 10 ? '0px 4px 12px rgba(0,0,0,0.1)' : '0px 1px 2px rgba(0,0,0,0.05)';
  });
