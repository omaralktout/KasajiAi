/* ===== Translations (كما هي) ===== */
const translations = {
  en: { /* ... نفس محتواك تماماً ... */ 
    "logo-text":"Voice Pulse","nav-voicepulse":"VoicePulse","nav-insightai":"InsightAI","nav-actionsync":"ActionSync","nav-insights":"Our Insights","nav-about":"About Us","nav-signup":"Sign up",
    "hero-title":"InsightAI","hero-description":"Advanced insights platform connecting experience to behavior, outcomes, and future expectations.",
    "patient-feedback-title":"Patient Feedback Insights","patient-feedback-desc":"A deep analytical approach to multi-source experience data, designed to turn feedback into measurable indicators.",
    "patient-feedback-feature-1":"Extracts recurring patterns from qualitative and quantitative inputs","patient-feedback-feature-2":"Links insights to clinical context, service type, and care stages","patient-feedback-feature-3":"Identifies expectation gaps versus actual outcomes","patient-feedback-feature-4":"Converts open feedback into structured, improvement-ready signals",
    "sentiment-title":"Sentiment & Emotion Insights","sentiment-desc":"Advanced interpretation of patient language and tone to uncover emotional drivers behind the experience, including trust, anxiety, relief, or concern.",
    "patient-intelligence-title":"Patient Intelligence and Experience Insights","patient-intelligence-desc":"A blended analysis of behavioral signals, personal perceptions, and service interactions to reveal deeper layers of the care journey.",
    "patient-intelligence-feature-1":"Connecting feedback with patterns of use and engagement","patient-intelligence-feature-2":"Tracing the influence of each touchpoint on overall perception","patient-intelligence-feature-3":"Prioritizing improvements based on real experiential impact",
    "predictive-title":"Predictive Insights","predictive-desc":"AI-powered forecasting that anticipates what may happen next—before patterns become visible operationally or clinically.","predictive-capabilities":"Core predictive capabilities:","predictive-feature-1":"Early risk identification","predictive-feature-2":"Anticipation of satisfaction shifts","predictive-feature-3":"Proactive decision support for service enhancement",
    "perspective-title":"Perspective Insights for Care Improvement","perspective-feature-1":"Compares patient expectations with delivered service reality","perspective-feature-2":"Highlights gaps between leadership, staff, and patient perceptions","perspective-feature-3":"Identifies improvement areas with the highest experiential return","perspective-feature-4":"Supports data-based decision-making over assumptions","perspective-desc":"A next-generation intelligence layer that transforms feedback into foresight and action.",
    "contact-title":"Ready to Transform Your Business?","contact-subtitle":"Get started today and see the difference our platform can make","contact-info-title":"Contact Information","contact-phone":"Phone","contact-email":"Email","contact-address":"Address","form-name":"Your Name","form-email":"Your Email","form-message":"Your Message","form-submit":"Send Message",
    "footer-description":"Transforming businesses through intelligent customer insights","footer-copyright":"© 2025 Kasaji.AI. All rights reserved."
  },
  ar: { /* ... نفس محتواك تماماً ... */
    "logo-text":"Voice Pulse","nav-voicepulse":"VoicePulse","nav-insightai":"InsightAI","nav-actionsync":"ActionSync","nav-insights":"رؤانا","nav-about":"من نحن","nav-signup":"سجل",
    "hero-title":"InsightAI","hero-description":"منصة رؤى متقدمة تربط التجربة بالسلوك والنتائج والتوقعات المستقبلية.",
    "patient-feedback-title":"رؤى ملاحظات المرضى","patient-feedback-desc":"نهج تحليلي عميق لبيانات التجارة متعددة المصادر، مصمم لتحويل الملاحظات إلى مؤشرات قابلة للقياس.",
    "patient-feedback-feature-1":"يستخرج الأنماط المتكررة من المدخلات النوعية والكمية","patient-feedback-feature-2":"يربط الرؤى بالسياق السريري ونوع الخدمة ومراحل الرعاية","patient-feedback-feature-3":"يحدد فجوات التوقعات مقابل النتائج الفعلية","patient-feedback-feature-4":"يحول الملاحظات المفتوحة إلى إشارات منظمة وجاهزة للتحسين",
    "sentiment-title":"رؤى المشاعر والعواطف","sentiment-desc":"تفسير متقدم للغة المريض ونبرته للكشف عن الدوافع العاطفية وراء التجربة، بما في ذلك الثقة والقلق والراحة أو القلق.",
    "patient-intelligence-title":"ذكاء المريض ورؤى التجربة","patient-intelligence-desc":"تحليل مدمج لإشارات السلوك والتصورات الشخصية وتفاعلات الخدمة للكشف عن طبقات أعمق من رحلة الرعاية.",
    "patient-intelligence-feature-1":"ربط الملاحظات بأنماط الاستخدام والمشاركة","patient-intelligence-feature-2":"تتبع تأثير كل نقطة اتصال على الإدراك العام","patient-intelligence-feature-3":"إعطاء الأولوية للتحسينات بناءً على التأثير التجريبي الحقيقي",
    "predictive-title":"رؤى تنبؤية","predictive-desc":"التنبؤ المدعوم بالذكاء الاصطناعي بما قد يحدث بعد ذلك - قبل أن تصبح الأنماط مرئية تشغيليًا أو سريريًا.","predictive-capabilities":"القدرات التنبؤية الأساسية:","predictive-feature-1":"التعرف المبكر على المخاطر","predictive-feature-2":"توقع تحولات الرضا","predictive-feature-3":"دعم القرار الاستباقي لتحسين الخدمة",
    "perspective-title":"رؤى منظورية لتحسين الرعاية","perspective-feature-1":"يقارن توقعات المرضى مع واقع الخدمة المقدمة","perspective-feature-2":"يسلط الضوء على الفجوات بين تصورات القيادة والموظفين والمرضى","perspective-feature-3":"يحدد مجالات التحسين ذات العائد التجريبي الأعلى","perspective-feature-4":"يدعم اتخاذ القرارات القائمة على البيانات بدلاً من الافتراضات","perspective-desc":"طبقة ذكاء من الجيل التالي تحول الملاحظات إلى رؤية مستقبلية وإجراء.",
    "contact-title":"هل أنت مستعد لتحويل أعمالك؟","contact-subtitle":"ابدأ اليوم وشاهد الفرق الذي يمكن أن تحدثه منصتنا","contact-info-title":"معلومات الاتصال","contact-phone":"الهاتف","contact-email":"البريد الإلكتروني","contact-address":"العنوان","form-name":"اسمك","form-email":"بريدك الإلكتروني","form-message":"رسالتك","form-submit":"إرسال الرسالة",
    "footer-description":"تحويل الشركات من خلال رؤى العملاء الذكية","footer-copyright":"© 2025 Kasaji.AI. جميع الحقوق محفوظة."
  }
};

/* ===== Language state (default EN) ===== */
let currentLanguage = localStorage.getItem('language') || 'en';

/* ===== Helpers ===== */
function updateLanguage(){
  const html = document.documentElement;
  const body = document.body;
  html.setAttribute('lang', currentLanguage);
  html.setAttribute('dir', currentLanguage === 'ar' ? 'rtl' : 'ltr');
  body.setAttribute('dir', currentLanguage === 'ar' ? 'rtl' : 'ltr'); // <-- لضمان توافق CSS

  document.querySelectorAll('[data-translate]').forEach(el=>{
    const key = el.getAttribute('data-translate');
    const v = translations[currentLanguage][key];
    if (v != null) el.textContent = v;
  });
  document.querySelectorAll('[data-translate-placeholder]').forEach(el=>{
    const key = el.getAttribute('data-translate-placeholder');
    const v = translations[currentLanguage][key];
    if (v != null) el.placeholder = v;
  });
}
function toggleLanguage(){
  currentLanguage = currentLanguage === 'en' ? 'ar' : 'en';
  localStorage.setItem('language', currentLanguage);
  updateLanguage();
}
window.toggleLanguage = toggleLanguage;

/* ===== Init ===== */
document.addEventListener('DOMContentLoaded',()=>{
  // Language
  updateLanguage();

  // Loader
  const loader = document.getElementById('loader');
  if (loader){ loader.style.opacity='0'; setTimeout(()=>{ loader.style.display='none'; }, 500); }

  // Stagger nicer: titles/descriptions inside .section
  document.querySelectorAll('.section').forEach((sec,i)=>{
    const title = sec.querySelector('.section-title');
    const desc  = sec.querySelector('.section-description');
    if (title) title.style.animationDelay = `${0.15 + i*0.1}s`;
    if (desc)  desc.style.animationDelay  = `${0.25 + i*0.1}s`;
  });

  // Footer reveal
  const animateElements = document.querySelectorAll('.contact-container, footer');
  if ('IntersectionObserver' in window){
    const io = new IntersectionObserver((entries)=>entries.forEach(e=>{ if(e.isIntersecting) e.target.classList.add('animate'); }),{threshold:.1});
    animateElements.forEach(el=>io.observe(el));
  } else {
    animateElements.forEach(el=>el.classList.add('animate'));
  }

  // Mobile menu toggle
  const menuToggle = document.querySelector('.menu-toggle');
  const navLinks = document.querySelector('.nav-links');
  if (menuToggle && navLinks){
    menuToggle.addEventListener('click', ()=>{
      const open = getComputedStyle(navLinks).display !== 'none';
      if (open){
        navLinks.style.display = 'none';
      } else {
        navLinks.style.display = 'flex';
        navLinks.style.position = 'absolute';
        navLinks.style.top = '70px';
        navLinks.style.left = '0';
        navLinks.style.right = '0';     // RTL-safe
        navLinks.style.flexDirection = 'column';
        navLinks.style.backgroundColor = 'white';
        navLinks.style.padding = '20px';
        navLinks.style.boxShadow = '0 5px 15px rgba(0,0,0,0.1)';
      }
    });
  }

  // Smooth scroll
  document.querySelectorAll('a[href^="#"]').forEach(a=>{
    a.addEventListener('click', e=>{
      const href = a.getAttribute('href');
      const target = document.querySelector(href);
      if (!target) return;
      e.preventDefault();
      const navbar = document.querySelector('.navbar');
      const offset = navbar ? navbar.offsetHeight : 0;
      window.scrollTo({ top: target.offsetTop - offset, behavior: 'smooth' });
    });
  });

  // Navbar shadow
  const navbar = document.querySelector('.navbar');
  window.addEventListener('scroll', ()=>{
    if (!navbar) return;
    navbar.style.boxShadow = window.scrollY > 10 ? '0px 4px 12px rgba(0,0,0,0.1)' : '0px 1px 2px rgba(0,0,0,0.05)';
  });

  // Contact form (as-is)
  const form = document.getElementById('contactForm');
  if (form){
    form.setAttribute('action','/send.php');
    if (!form.querySelector('input[name="company"]')){
      const hp=document.createElement('input'); hp.type='text'; hp.name='company';
      hp.style.display='none'; hp.tabIndex=-1; hp.autocomplete='off'; form.appendChild(hp);
    }
    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const btn = form.querySelector('.submit-btn'); const original = btn?btn.textContent:'';
      if (btn){ btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ' + (currentLanguage==='ar'?'جارٍ الإرسال...':'Sending...'); btn.disabled = true; }
      try{
        const res = await fetch(form.action,{ method:'POST', body:new FormData(form) });
        const txt = (await res.text()).trim();
        if (res.ok && txt === 'OK'){ form.reset(); }
      } catch(err){ console.error(err); }
      finally{ if (btn){ btn.textContent = original; btn.disabled = false; } }
    });
  }
});
